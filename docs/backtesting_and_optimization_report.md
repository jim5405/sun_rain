# 長期回測與策略優化報告

本報告旨在記錄對本專案核心交易策略進行的長期回測、績效分析、二次優化及最終結果驗證的完整流程。

## 1. 初始策略 (`Model_conf`) 的 10 年長期回測

我們首先使用 `tools/long_term_backtester.py` 對 `Model_conf`（經過第一輪報酬率優化）的策略進行了為期 10 年的回測。

- **測試標的**: `2330.TW`, `AAPL`, `0.5`, `QQQ`
- **回測期間**: 過去 10 年
- **綜合平均績效**:
  - **年化報酬率**: 8.85%
  - **夏普比率**: 0.54
  - **最大回撤**: -20.01%
  - **勝率**: 47.09%
  - **年交易次數**: 4.2 次
- **核心問題**: 策略的長期報酬率**顯著低於**買入並持有（B&H）策略，顯示其在牛市中**過於保守**。

---

## 2. 策略的二次優化

根據長期回測的分析，我們以**最大化夏普比率 (max_sharpe)** 為目標，進行了二次參數優化，並將結果儲存為 `config/Model_conf_finetuned.py`。

- **優化目標**: 在風險與回報之間尋求更佳平衡。
- **參數調整**: 使策略對市場趨勢的反應更為靈敏，同時避免過早賣出。

---

## 3. 最終模型 (`Finetuned`) 的 10 年回測驗證

為了驗證二次優化的成果，我們採用新的 `Model_conf_finetuned.py` 設定檔，對同樣的標的進行了最終的 10 年回測。

### 3.1. `Finetuned` 模型回測結果

| Ticker  | Strategy Return | B&H Return | Annualized Return | Sharpe Ratio | Max Drawdown | Win Rate | Trades (10y) |
| :------ | :-------------- | :--------- | :---------------- | :----------- | :----------- | :------- | :----------- |
| 2330.TW | 86.86%          | 888.03%    | 7.31%             | 0.41         | -30.41%      | 38.46%   | 26           |
| AAPL    | 253.38%         | 982.92%    | 14.73%            | 0.67         | -29.52%      | 44.83%   | 29           |
| 0050.TW | 225.46%         | 366.78%    | 14.24%            | 1.04         | -10.44%      | 71.43%   | 14           |
| QQQ     | 265.58%         | 466.20%    | 15.16%            | 0.89         | -24.32%      | 42.11%   | 19           |

### 3.2. 新舊模型績效對比

| 指標 (綜合平均) | 舊模型 (`Model_conf`) | 新模型 (`Finetuned`) | 變化 | 分析 |
| :--- | :--- | :--- | :--- | :--- |
| **年化報酬率** | 8.85% | **12.86%** | <font color="green">▲ +4.01%</font> | **顯著提升**。新模型更靈敏的參數成功捕捉了更多上漲趨勢。 |
| **夏普比率** | 0.54 | **0.75** | <font color="green">▲ +0.21</font> | **顯著提升**。證明新模型在風險調整後的報酬表現更佳。 |
| **最大回撤** | **-20.01%** | -23.67% | <font color="red">▼ -3.66%</font> | 輕微增加，換取了更高的報酬，風險仍在可控範圍。 |
| **勝率** | 47.09% | **49.21%** | <font color="green">▲ +2.12%</font> | 有所提升。 |
| **年交易次數** | 4.2 次 | **2.2 次** | <font color="blue">▼ -2.0 次</font> | **顯著降低**。交易訊號更精準，避免了不必要的交易成本。 |

---

## 4. 結論

二次優化取得了巨大成功。新的 `Finetuned` 模型在**所有關鍵績效指標**上均優於舊模型。它不僅**提升了獲利能力**（更高的年化報酬率），還**改善了風險管理**（更高的夏普比率），並**提高了交易效率**（更低的交易頻率）。

雖然擇時策略在長達十年的牛市中完全超越 B&H 是一個極具挑戰性的目標，但 `Finetuned` 模型已經大幅縮小了差距，並在風險控制上展現了其不可替代的價值。此模型已準備好在 `Auto_scan.py` 中進行實際應用。
